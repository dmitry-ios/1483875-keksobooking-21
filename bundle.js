(()=>{"use strict";window.constants={SIZE_OF_MOCK:8,MAP_WIDTH:1200,MAX_LOCATION_Y:630,MIN_LOCATION_Y:130,MAX_PRICE:10500,MIN_PRICE:1e3,PIN_OFFSET_X:-33,PIN_OFFSET_Y:-70,SHORT_TITLE_MESSAGE:"–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ ‚Äî 30 —Å–∏–º–≤–æ–ª–æ–≤",LONG_TITLE_MESSAGE:"–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ ‚Äî 100 —Å–∏–º–≤–æ–ª–æ–≤",MISSING_TITLE_MESSAGE:"–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ",LEFT_MOUSE_BUTTON:0,ENTER_KEYBOARD:"Enter",ESCAPE_KEYBOARD:"Escape"},window.util={randomRange:function(e,t){return Math.floor(Math.random()*(t-e))+e},shuffleArray:function(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*t),o=e[t];e[t]=e[n],e[n]=o}},makeElements:function(e,t){let n=[];for(let o=0;o<e;o++)n[o]=t(o);return n},generateAvatarUrl:function(e){return`img/avatars/user${(e+=1)<10?"0"+e:e}.png`},errorHandler:function(e){const t=document.createElement("div");t.style="z-index: 100; padding: 10px; margin: 0 auto; color: #fff; font-weight: 500; text-align: center; background-color: #f44336; border-radius: 4px;",t.style.position="absolute",t.style.top="5px",t.style.left="15px",t.style.right="15px",t.style.fontSize="30px",t.textContent="üò≤ "+e,t.addEventListener("click",(function(){t.remove()})),window.scrollTo(0,0),document.body.insertAdjacentElement("afterbegin",t)},limitMapX:function(e){return e=Math.max(e,window.constants.PIN_OFFSET_X),Math.min(e,window.constants.MAP_WIDTH+window.constants.PIN_OFFSET_X)},limitMapY:function(e){return e=Math.max(e,window.constants.MIN_LOCATION_Y+window.constants.PIN_OFFSET_Y),Math.min(e,window.constants.MAX_LOCATION_Y+window.constants.PIN_OFFSET_Y)},debounce:function(e){let t=null;return function(...n){let o=n;t&&window.clearTimeout(t),t=window.setTimeout((function(){e(...o)}),500)}}},window.data={TITLES:["–ú–∏–ª–∞—è, —É—é—Ç–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞ –≤ —Ü–µ–Ω—Ç—Ä–µ –¢–æ–∫–∏–æ","–§—É—Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ –∂–∏–ª—å–µ –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º —Ä–∞–π–æ–Ω–µ","–î–≤–æ—Ä–µ—Ü —Å —Ä–æ–±–æ—Ç–∞–º–∏","–õ–∏—á–Ω—ã–π –¥–æ–º —Å –∫–æ—Ç–∏–∫–∞–º–∏ –∏ —Å–æ–±–∞—á–∫–∞–º–∏","–ë—É–Ω–≥–∞–ª–æ —Å–æ –≤—Å–µ–º–∏ —É–¥–æ–±—Å—Ç–≤–∞–º–∏","–ú–∞–ª–µ–Ω—å–∫–∞—è –∫–æ–º–Ω–∞—Ç–∫–∞ —Å–æ —Å–∫–æ—Ä–æ—Å—Ç–Ω—ã–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º","–ë–æ–ª—å—à–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞ –¥–ª—è –±–æ–ª—å—à–æ–π –∫–æ–º–ø–∞–Ω–∏–∏","–†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ –≥–Ω–µ–∑–¥—ã—à–∫–æ –≤ –≥–æ—Ä–æ–¥–µ –±—É–¥—É—â–µ–≥–æ"],TYPES:["palace","flat","house","bungalow"],ANY_TYPE:"any",valuesType:{flat:"–ö–≤–∞—Ä—Ç–∏—Ä–∞",bungalow:"–ë—É–Ω–≥–∞–ª–æ",house:"–î–æ–º",palace:"–î–≤–æ—Ä–µ—Ü"},minPrice:{flat:1e3,bungalow:0,house:5e3,palace:1e4},TIMES:["12:00","13:00","14:00"],FEATURES:["wifi","dishwasher","parking","washer","elevator","conditioner"],PHOTOS:["http://o0.github.io/assets/images/tokyo/hotel1.jpg","http://o0.github.io/assets/images/tokyo/hotel2.jpg","http://o0.github.io/assets/images/tokyo/hotel3.jpg"],roomValidityMessage:{1:"1 –∫–æ–º–Ω–∞—Ç–∞ ‚Äî ¬´–¥–ª—è 1 –≥–æ—Å—Ç—è¬ª",2:"2 –∫–æ–º–Ω–∞—Ç—ã ‚Äî ¬´–¥–ª—è 2 –≥–æ—Å—Ç–µ–π¬ª –∏–ª–∏ ¬´–¥–ª—è 1 –≥–æ—Å—Ç—è¬ª",3:"3 –∫–æ–º–Ω–∞—Ç—ã ‚Äî ¬´–¥–ª—è 3 –≥–æ—Å—Ç–µ–π¬ª, ¬´–¥–ª—è 2 –≥–æ—Å—Ç–µ–π¬ª –∏–ª–∏ ¬´–¥–ª—è 1 –≥–æ—Å—Ç—è¬ª",100:"100 –∫–æ–º–Ω–∞—Ç ‚Äî ¬´–Ω–µ –¥–ª—è –≥–æ—Å—Ç–µ–π¬ª"},offers:[]},(()=>{const e=function(e,t,n,o){const i=o?"POST":"GET",r=new XMLHttpRequest;r.responseType="json",r.timeout=5e3,r.addEventListener("load",(function(){200===r.status?t(r.response):n(`–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${r.status} ${r.statusText}`)})),r.addEventListener("error",(function(){n("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è")})),r.addEventListener("timeout",(function(){n(`–ó–∞–ø—Ä–æ—Å –Ω–µ —É—Å–ø–µ–ª –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –∑–∞ ${r.timeout} –º—Å`)})),r.open(i,e),o?r.send(o):r.send()};window.backend={load:function(t,n){e("https://21.javascript.pages.academy/keksobooking/data",t,n)},save:function(t,n,o){e("https://21.javascript.pages.academy/keksobooking",n,o,t)}}})(),(()=>{const e=window.util.makeElements(window.constants.SIZE_OF_MOCK,window.util.generateAvatarUrl),t=document.querySelector(".map__pins").clientWidth,n=function(n){window.util.shuffleArray(window.data.PHOTOS),window.util.shuffleArray(window.data.FEATURES);const o=window.util.randomRange(1,window.data.FEATURES.length),i=window.data.FEATURES.slice(0,o),r=window.util.randomRange(1,window.data.PHOTOS.length),a=window.data.PHOTOS.slice(0,r),d=window.util.randomRange(0,window.util.randomRange(0,t)),s=window.util.randomRange(window.constants.MIN_LOCATION_Y,window.constants.MAX_LOCATION_Y);return{author:{avatar:e[n]},offer:{title:window.data.TITLES[n],address:`${d}, ${s}`,price:window.util.randomRange(window.constants.MIN_PRICE,window.constants.MAX_PRICE),type:window.data.TYPES[window.util.randomRange(0,window.data.TYPES.length-1)],rooms:window.util.randomRange(1,5),guests:window.util.randomRange(1,5),checkin:window.data.TIMES[window.util.randomRange(0,window.data.TIMES.length-1)],checkout:window.data.TIMES[window.util.randomRange(0,window.data.TIMES.length-1)],features:i,description:`–ó–∞–º–µ—á–∞—Ç–µ–ª—å–Ω–æ–µ –∂–∏–ª—å–µ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º (${d}, ${s}) —Å ${i.join(", ")}`,photos:a},location:{x:d,y:s}}},o=function(e,t){const n=e.location.y,o=t.location.y;return n<o?-1:n>o?1:0};window.mock={makeMockOffers:function(){window.util.shuffleArray(window.data.TITLES),window.util.shuffleArray(e);const t=window.util.makeElements(window.constants.SIZE_OF_MOCK,n);return t.sort(o),t}}})(),(()=>{const e=document.querySelector(".map"),t=document.querySelector("#card"),n=t.content.querySelector(".map__card"),o=document.querySelector(".map__filters-container"),i=function(){let t=e.querySelector(".map__card");t&&(document.removeEventListener("keydown",r),t.remove(),t=null)},r=function(e){e.key===window.constants.ESCAPE_KEYBOARD&&i()};window.card={showCard:function(a){i(),document.addEventListener("keydown",r),e.insertBefore(function(e){const o=n.cloneNode(!0),r=e.offer;var a,d,s,c;return o.querySelector(".popup__title").textContent=r.title,o.querySelector(".popup__text--address").textContent=r.address,function(e,t){const n=document.createElement("span"),o=t.querySelector(".popup__text--price");o.textContent=e.price+"‚ÇΩ",n.textContent="/–Ω–æ—á—å",o.insertAdjacentElement("beforeend",n)}(r,o),o.querySelector(".popup__type").textContent=window.data.valuesType[r.type],o.querySelector(".popup__text--capacity").textContent=function(e){return`${e.rooms} –∫–æ–º–Ω–∞—Ç—ã –¥–ª—è ${e.guests} –≥–æ—Å—Ç–µ–π`}(r),o.querySelector(".popup__text--time").textContent=function(e){return`–ó–∞–µ–∑–¥ –ø–æ—Å–ª–µ ${e.checkin}, –≤—ã–µ–∑–¥ –¥–æ ${e.checkout}`}(r),o.querySelector(".popup__description").textContent=r.description,a=r.features,(d=o.querySelector(".popup__features")).innerHTML="",a.forEach((function(e){const t=document.createElement("li");t.classList.add("popup__feature"),t.classList.add("popup__feature--"+e),d.appendChild(t)})),s=r.photos,(c=o.querySelector(".popup__photos")).innerHTML="",s.forEach((function(e){const n=t.content.querySelector(".popup__photo").cloneNode(!0);n.src=e,c.appendChild(n)})),o.querySelector(".popup__avatar").src=e.author.avatar,o.querySelector(".popup__close").addEventListener("click",(function(){i()})),o}(a),o)},hideCard:i}})(),(()=>{const e=document.querySelector("#pin").content.querySelector(".map__pin"),t=document.querySelector(".map__pins"),n=document.querySelector("#error").content.querySelector(".error"),o=document.querySelector("#success").content.querySelector(".success"),i=document.querySelector("main"),r=function(t){const n=e.cloneNode(!0),o=n.querySelector("img");return n.style=`left: ${t.location.x+window.constants.PIN_OFFSET_X}px; top: ${t.location.y+window.constants.PIN_OFFSET_Y}px;`,o.src=t.author.avatar,o.alt=t.offer.title,n.addEventListener("click",(function(){window.card.showCard(t)})),n},a=function(e,t,n,o){const r=function(){e.remove(),window.removeEventListener("keydown",a)},a=function(e){e.key===window.constants.ESCAPE_KEYBOARD&&r()};e.addEventListener("click",(function(){r()})),t&&n&&(t.textContent=n),o&&o.addEventListener("click",(function(){r()})),window.addEventListener("keydown",a),i.insertAdjacentElement("afterbegin",e)};window.render={setupSimilarPins:function(e){const n=function(e){const t=document.createDocumentFragment(),n=Math.min(e.length,5);for(let o=0;o<n;o++){const n=r(e[o]);t.appendChild(n)}return t}(e);t.appendChild(n)},showErrorMessage:function(e){const t=n.cloneNode(!0),o=t.querySelector(".error__message"),i=t.querySelector(".error__button");a(t,o,e,i)},showSuccessMessage:function(){const e=o.cloneNode(!0);a(e)}}})(),(()=>{const e=document.querySelector(".map"),t=e.querySelector("select[name=housing-type]"),n=e.querySelector("select[name=housing-rooms]"),o=e.querySelector("select[name=housing-guests]"),i=e.querySelector("select[name=housing-price]"),r=document.querySelectorAll("input[type=checkbox]");let a=[];window.filter={getFilteredOffers:e=>(a=Array.from(r).filter((e=>e.matches(":checked"))),e.filter((e=>(e=>t.value===window.data.ANY_TYPE||e.offer.type===t.value)(e)&&(e=>{const t=e.offer.price;switch(i.value){case window.data.ANY_TYPE:return!0;case"middle":return t>=1e4&&t<5e4;case"low":return t<1e4;case"high":return t>=5e4;default:return!1}})(e)&&(e=>n.value===window.data.ANY_TYPE||e.offer.rooms===Number(n.value))(e)&&(e=>o.value===window.data.ANY_TYPE||e.offer.guests===Number(o.value))(e)&&(e=>0===a.length||a.filter((t=>e.offer.features.includes(t.value))).length===a.length)(e))))}})(),(()=>{const e=document.querySelector(".map__pin--main"),t=document.querySelector(".ad-form"),n=t.querySelector(".ad-form-header"),o=t.querySelectorAll(".ad-form__element"),i=document.querySelector(".map__filters"),r=i.querySelectorAll(".map__filter"),a=i.querySelectorAll(".map__features"),d=t.querySelector("input[name=address]"),s=function(e){e.disabled=!0},c=function(e){e.disabled=!1};window.form={formNode:t,enableFilters:function(){r.forEach(c),a.forEach(c)},disableFilters:function(){r.forEach(s),a.forEach(s)},disableInputs:function(){t.classList.add("ad-form--disabled"),s(n),o.forEach(s)},enableInputs:function(){t.classList.remove("ad-form--disabled"),c(n),o.forEach(c)},setInputAddress:function(){let t=e.offsetLeft,n=e.offsetTop;t-=window.constants.PIN_OFFSET_X,n-=window.constants.PIN_OFFSET_Y,d.value=`${t}, ${n}`},isActivePage:!0}})(),(()=>{const e=document.querySelector(".map__pins"),t=document.querySelector(".map__filters"),n=function(e){window.data.offers=e,e.length>0&&window.form.enableFilters(),i()},o=function(){e.querySelectorAll(".map__pin:not(.map__pin--main)").forEach((function(e){e.remove()}))},i=function(){o(),window.card.hideCard();const e=window.filter.getFilteredOffers(window.data.offers);window.render.setupSimilarPins(e)};t.addEventListener("change",window.util.debounce(i)),window.pin={showMapPins:function(){window.backend.load(n,window.util.errorHandler)},hideMapPins:o}})(),(()=>{const e=document.querySelector(".map"),t=document.querySelector(".map__pin--main"),n=function(){r(),window.form.setInputAddress(),t.removeEventListener("mousedown",o),t.removeEventListener("keydown",i)},o=function(e){e.button===window.constants.LEFT_MOUSE_BUTTON&&n()},i=function(e){e.key===window.constants.ENTER_KEYBOARD&&n()},r=function(){window.form.isActivePage=!0,e.classList.remove("map--faded"),window.pin.showMapPins(),window.form.enableInputs()};window.map={deactivatePage:function(){window.form.isActivePage=!1,e.classList.add("map--faded"),t.addEventListener("mousedown",o),t.addEventListener("keydown",i),window.pin.hideMapPins(),window.form.disableInputs(),window.form.disableFilters()}}})(),(()=>{const e=document.querySelector(".map__pin--main"),t=e.style.top,n=e.style.left,o=function(){window.card.hideCard(),window.form.setInputAddress()};e.addEventListener("mousedown",(function(t){o();let n={x:t.clientX,y:t.clientY};const i=function(t){t.preventDefault();let o=n.x-t.clientX,i=n.y-t.clientY;n={x:t.clientX,y:t.clientY};let r=window.util.limitMapX(e.offsetLeft-o),a=window.util.limitMapY(e.offsetTop-i);e.style.top=a+"px",e.style.left=r+"px"},r=function(e){e.preventDefault(),o(),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",r)};document.addEventListener("mousemove",i),document.addEventListener("mouseup",r)})),window.move={resetPositionPin:function(){e.style.top=t,e.style.left=n}}})(),(()=>{const e=function(){window.form.formNode.reset(),window.card.hideCard(),window.map.deactivatePage(),window.move.resetPositionPin(),window.form.setInputAddress(),window.render.showSuccessMessage()},t=function(e){window.render.showErrorMessage(e)};window.form.formNode.addEventListener("submit",(function(n){const o=new FormData(window.form.formNode);window.backend.save(o,e,t),n.preventDefault()})),window.form.formNode.querySelector(".ad-form__reset").addEventListener("click",(function(e){e.preventDefault(),window.form.formNode.reset(),window.form.setInputAddress()}))})(),(()=>{const e=window.form.formNode.querySelector("select[name=capacity]"),t=window.form.formNode.querySelector("select[name=rooms]"),n=window.form.formNode.querySelector("input[name=title]"),o=window.form.formNode.querySelector("select[name=type]"),i=window.form.formNode.querySelector("input[name=price]"),r=window.form.formNode.querySelector("select[name=timein]"),a=window.form.formNode.querySelector("select[name=timeout]"),d=function(){const n=+e.value,o=+t.value;let i=!0;return 100===o&&0!==n||100!==o&&(n<1||n>o)?(e.setCustomValidity(window.data.roomValidityMessage[o]),i=!1):e.setCustomValidity(""),e.reportValidity(),i};n.addEventListener("invalid",(function(){const e=n.validity;e.tooShort?n.setCustomValidity(window.constants.SHORT_TITLE_MESSAGE):e.tooLong?n.setCustomValidity(window.constants.LONG_TITLE_MESSAGE):e.valueMissing?n.setCustomValidity(window.constants.MISSING_TITLE_MESSAGE):n.setCustomValidity("")})),e.addEventListener("change",(function(){d()})),t.addEventListener("change",(function(){d()})),window.form.formNode.addEventListener("submit",(function(e){d()||e.preventDefault()}));const s=function(){const e=window.data.minPrice[o.value];i.placeholder=e},c=function(){const e=o.value,t=i.value,n=window.data.minPrice[e];t<n?i.setCustomValidity(`¬´${window.data.valuesType[e]}¬ª ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –∑–∞ –Ω–æ—á—å ${n}`):i.setCustomValidity(""),i.reportValidity()};o.addEventListener("change",(function(){s(),c()})),i.addEventListener("input",(function(){c()})),s(),r.addEventListener("change",(function(e){a.value=e.target.value})),a.addEventListener("change",(function(e){r.value=e.target.value}))})(),window.map.deactivatePage(),window.form.setInputAddress()})();